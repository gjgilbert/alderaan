import os
import sys
import warnings

from alderaan.modules.transit import RBDTransitModel

def run(context):
    print('\n\nSUBRECIPE: QUICK FIT TRANSIT SHAPE\n')

    # infer context
    planets = context.planets
    litecurve = context.litecurve
    limbdark = context.limbdark

    # optimize transit parameters
    transitmodel = RBDTransitModel(litecurve, planets, limbdark)
    transitmodel = transitmodel.trim_flux_arrays(rel_size=3.0, abs_size=1/24)

    print("Supersample factor")
    for obsmode in transitmodel.unique_obsmodes:
        print(f"  {obsmode} : {transitmodel._obsmode_to_supersample(obsmode)}")

    print("\nFitting initial transit model")
    theta = transitmodel.optimize()
    planets = transitmodel.update_planet_parameters(theta)
    limbdark = transitmodel.update_limbdark_parameters(theta)

    return {'planets': planets,
            'limbdark': limbdark
            }

